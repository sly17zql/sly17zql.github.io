---
title: 【每日算法题】骑士在棋盘上的概率
tags:
  - 动态规划
description: 每天一道算法题，让生活变得更好
categories:
  - 学习
  - 代码
  - 算法
abbrlink: 50815
date: 2024-12-07 21:49:08
updated: 2024-12-07 21:49:08
---

### 骑士在棋盘上的概率

在一个 n x n 的国际象棋棋盘上，一个骑士从单元格 (row, column) 开始，并尝试进行 k 次移动。行和列是 从 0 开始 的，所以左上单元格是 (0,0) ，右下单元格是 (n - 1, n - 1) 。

象棋骑士有8种可能的走法，如下图所示。每次移动在基本方向上是两个单元格，然后在正交方向上是一个单元格。

每次骑士要移动时，它都会随机从8种可能的移动中选择一种(即使棋子会离开棋盘)，然后移动到那里。

骑士继续移动，直到它走了 k 步或离开了棋盘。

返回 骑士在棋盘停止移动后仍留在棋盘上的概率 。

### 解答

```python
class Solution:
    def knightProbability(self, n: int, k: int, row: int, column: int) -> float:
        if k == 0:
            return 1
        direction = [[-1, -2], [-2, -1], [-2, 1], [-1, 2], [1, -2], [2, -1], [2, 1], [1, 2]]

        pre = [[0 for _ in range(n)] for _ in range(n)]
        for i in range(k):
            new_pre = [[0 for _ in range(n)] for _ in range(n)]
            for x in range(n):
                for y in range(n):
                    cur = 0
                    for d in direction:
                        new_x = x + d[0]
                        new_y = y + d[1]
                        if 0 <= new_x < n and 0 <= new_y < n:
                            cur += pre[new_x][new_y] if i >= 1 else 1
                    new_pre[x][y] = cur
            pre = new_pre
        return pre[row][column] / (8**k)
```

### 思路

判断 k 次移动后，仍然在棋盘内的可能，可以分解为 k-1 次移动后的结果后继续，那么要 k 次移动在棋盘内，k-1次的时候也一定要在棋盘内，在 k-1次移动的基础上，再次移动。

那么 row，col 在 k次移动后仍然在棋盘上，从8个方向上，它可以从这8个方向上来，那么每个方向的可能有多少。

f(k) = f1(k-1) + f2(k-1) + ... + f8(k-1)

### 复杂度

时间复杂度：O(n^2 * K)

空间复杂度：O(n^2)
